<div
    class="filter-container"
    [ngClass]="{ 'has-input': filterInputVisible$ | async }"
    [ngClass]="{ 'keyword-full-width': keywordFullWidth$ | async }">
  @if (filterInputVisible$ | async) {
    <ng-container *ngTemplateOutlet="headingTmpl"></ng-container>
  }
  <div class="filter-bar-container">
    @if (filterInputVisible$ | async) {
      <div class="filter-input-container">
        @if (keywordVisible$ | async) {
          <fs-keyword-input [autofocus]="config.autofocus"></fs-keyword-input>
        }
        @if (savedFilterController.enabled) {
          <fs-saved-filter-autocomplete-chips [savedFiltersController]="savedFilterController"></fs-saved-filter-autocomplete-chips>
        }
        <ng-container [ngTemplateOutlet]="filterToolbarTmpl"></ng-container>
      </div>
    } @else if (hasHeading) {
      <div class="filter-heading-container">
        <ng-container *ngTemplateOutlet="headingTmpl"></ng-container>
        <ng-container [ngTemplateOutlet]="filterToolbarTmpl"></ng-container>
      </div>
    } @else {
      <ng-container [ngTemplateOutlet]="filterToolbarTmpl"></ng-container>
      <ng-container *ngTemplateOutlet="chipsTmpl"></ng-container>
    }
    <ng-container [ngTemplateOutlet]="filterActionsTmpl"></ng-container>
  </div>
  <ng-container *ngTemplateOutlet="statusBarTmpl"></ng-container>
  @if ((filterInputVisible$ | async) === true || hasHeading) {
    <ng-container
      [ngTemplateOutlet]="chipsTmpl"
      [ngTemplateOutletContext]="{ topMargin: true }">
    </ng-container>
  }
</div>
<ng-template
    #chipsTmpl
    let-topMargin="topMargin">
  <fs-filter-chips
    class="filter-chips"
    [ngClass]="{ 'top-margin': topMargin }">
  </fs-filter-chips>
</ng-template>
<ng-template #statusBarTmpl>
  @if (statusBar) {
    <div
        class="filter-status-container"
        [ngClass]="{ 'has-status': !!filterStatus.textContent }">
      <div
          class="filter-status"
          #filterStatus>
        <ng-container *ngTemplateOutlet="statusBar.templateRef"></ng-container>
      </div>
    </div>
  }
</ng-template>
<ng-template #filterActionsTmpl>
  @if ((actionsVisible$ | async)) {
    <div class="filter-actions">
      <fs-filter-actions
        [actions]="actions$ | async"
        [kebabActions]="menuActions$ | async">
      </fs-filter-actions>
    </div>
  }
</ng-template>
<ng-template #filterToolbarTmpl>
  @if (config.reload || config.autoReload || (filtersVisible$ | async)) {
    <div class="filter-toolbar">
      @if (config.reload) {
        <a
            mat-icon-button
            (click)="reload($event)"
            class="button-reload">
          <mat-icon #reloadEl>
            refresh
          </mat-icon>
        </a>
      }
      @if (config.autoReload) {
        <div class="filter-reload">
          <mat-slide-toggle
              name="autoReload"
              class="auto-reload"
              [ngModel]="config.autoReload.enabled"
              (ngModelChange)="config.autoReload.enabled = $event">
            <span>
              Auto refresh
            </span>
          </mat-slide-toggle>
        </div>
      }
    </div>
  }
</ng-template>
<ng-template #headingTmpl>
  @if (headingTemplate) {
    <ng-container *ngTemplateOutlet="headingTemplate"></ng-container>
  } @else if (config.heading) {
    <div class="heading">
      <h2>
        {{ config.heading }}
      </h2>
      <div class="subheading">
        {{ config.subheading }}
      </div>
    </div>
  }
</ng-template>